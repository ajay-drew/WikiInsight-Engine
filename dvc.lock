schema: '2.0'
stages:
  fetch_data:
    cmd: python -m src.ingestion.fetch_wikipedia_data
    deps:
    - path: src/ingestion
      hash: md5
      md5: ed432621f1d6307134d4d47cfc07310d.dir
      size: 15263
      nfiles: 5
    params:
      params.yaml:
        data:
          wikipedia:
            site: en.wikipedia.org
            api_rate_limit: 200
            cache_ttl: 3600
    outs:
    - path: data/raw/articles.json
      hash: md5
      md5: 692bc49488f1d292d4398755ef8b299e
      size: 6202467
  preprocess:
    cmd: python -m src.preprocessing.process_data
    deps:
    - path: data/raw/articles.json
      hash: md5
      md5: 692bc49488f1d292d4398755ef8b299e
      size: 6202467
    - path: src/preprocessing
      hash: md5
      md5: ab6a6e654a51a7f62a83928fbdbdc0dc.dir
      size: 11880
      nfiles: 5
    params:
      params.yaml:
        preprocessing:
          embeddings:
            model: all-MiniLM-L6-v2
            batch_size: 32
          graph:
            similarity_threshold: 0.7
    outs:
    - path: data/features/embeddings.parquet
      hash: md5
      md5: 58a69f81a3e15b963b3006b3131cc5e4
      size: 316620
    - path: data/processed/cleaned_articles.parquet
      hash: md5
      md5: b30ba99830fa864268cfff1c4c776966
      size: 4869846
  cluster_topics:
    cmd: python -m src.modeling.cluster_topics
    deps:
    - path: data/features/embeddings.parquet
      hash: md5
      md5: 58a69f81a3e15b963b3006b3131cc5e4
      size: 316620
    - path: src/modeling
      hash: md5
      md5: b5cce2fc880ab8612a1df4e90d2a060b.dir
      size: 24462
      nfiles: 3
    params:
      params.yaml:
        models.clustering:
          method: agglomerative
          n_clusters: 100
          random_state: 42
        models.neighbors:
          n_neighbors: 10
          algorithm: auto
    outs:
    - path: models/clustering/cluster_assignments.parquet
      hash: md5
      md5: 5bd9df9404d5f206c102208db137931e
      size: 3962
    - path: models/clustering/clusters_summary.parquet
      hash: md5
      md5: ae748ba98ff4e6f49ed26b068eaa64ba
      size: 21365
    - path: models/clustering/kmeans_model.pkl
      hash: md5
      md5: 4dc9929392843c0885a81dda22b69a58
      size: 308436
    - path: models/clustering/metrics.json
      hash: md5
      md5: 8861292f337dcd6033a9a4186b279cc3
      size: 47
    - path: models/clustering/nn_index.pkl
      hash: md5
      md5: 3ad12c61b4d6964b566c843fdc83bbf9
      size: 307795
