schema: '2.0'
stages:
  fetch_data:
    cmd: python -m src.ingestion.fetch_wikipedia_data
    deps:
    - path: src/ingestion
      hash: md5
      md5: ef59dc4f378a03a1f5b9fdb21dd71fae.dir
      size: 32746
      nfiles: 5
    params:
      params.yaml:
        data:
          wikipedia:
            site: en.wikipedia.org
            api_rate_limit: 200
            cache_ttl: 3600
    outs:
    - path: data/raw/articles.json
      hash: md5
      md5: 7a1822e271757654324e02c217ecf3af
      size: 18621537
  preprocess:
    cmd: python -m src.preprocessing.process_data
    deps:
    - path: data/raw/articles.json
      hash: md5
      md5: 7a1822e271757654324e02c217ecf3af
      size: 18621537
    - path: src/preprocessing
      hash: md5
      md5: 3f0abd8d5a4cc973ea14b64a6827d296.dir
      size: 21133
      nfiles: 5
    params:
      params.yaml:
        preprocessing:
          embeddings:
            model: all-MiniLM-L6-v2
            batch_size: 32
    outs:
    - path: data/features/embeddings.parquet
      hash: md5
      md5: 8a7d196c7262ec78cd314c8f16f04861
      size: 927481
    - path: data/processed/cleaned_articles.parquet
      hash: md5
      md5: 8e9115979756589ef736b8e47f4e0b10
      size: 18731061
  cluster_topics:
    cmd: python -m src.modeling.cluster_topics
    deps:
    - path: data/features/embeddings.parquet
      hash: md5
      md5: 8a7d196c7262ec78cd314c8f16f04861
      size: 927481
    - path: src/modeling
      hash: md5
      md5: 1e793285a4857a495dd759af72109edb.dir
      size: 31641
      nfiles: 3
    params:
      params.yaml:
        models.clustering:
          method: agglomerative
          n_clusters: 100
          random_state: 42
        models.neighbors:
          n_neighbors: 10
          algorithm: auto
    outs:
    - path: models/clustering/cluster_assignments.parquet
      hash: md5
      md5: 6433ee7900d43d023c33775b5e149b6e
      size: 6819
    - path: models/clustering/clusters_summary.parquet
      hash: md5
      md5: a29ecce381ae1b8adca704588de96e9c
      size: 23128
    - path: models/clustering/kmeans_model.pkl
      hash: md5
      md5: aea81f9e856aea32c44409dee770f54a
      size: 309956
    - path: models/clustering/metrics.json
      hash: md5
      md5: eaad952a754543b2e9efa28c07595e32
      size: 262
    - path: models/clustering/nn_index.pkl
      hash: md5
      md5: be221c2ee8ce5631fd518cf6803202e2
      size: 891476
  build_graph:
    cmd: python -m src.graph.build_graph
    deps:
    - path: config.yaml
      hash: md5
      md5: 9323c9f25104d1bcc98fa369628926f2
      size: 3376
    - path: data/features/embeddings.parquet
      hash: md5
      md5: 8a7d196c7262ec78cd314c8f16f04861
      size: 927481
    - path: data/processed/cleaned_articles.parquet
      hash: md5
      md5: 8e9115979756589ef736b8e47f4e0b10
      size: 18731061
    - path: models/clustering/cluster_assignments.parquet
      hash: md5
      md5: 6433ee7900d43d023c33775b5e149b6e
      size: 6819
    params:
      params.yaml:
        graph:
          semantic_similarity_threshold: 0.7
          max_nodes_per_visualization: 100
          enable_cluster_edges: true
    outs:
    - path: data/graph/knowledge_graph.pkl
      hash: md5
      md5: 2163455b9521652b75cbd6315a731de5
      size: 66514
