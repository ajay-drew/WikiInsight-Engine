schema: '2.0'
stages:
  fetch_data:
    cmd: python -m src.ingestion.fetch_wikipedia_data
    deps:
    - path: src/ingestion
      hash: md5
      md5: a11c090bd1000c1c1ecc2f0d6dda5f07.dir
      size: 25782
      nfiles: 5
    params:
      params.yaml:
        data:
          wikipedia:
            site: en.wikipedia.org
            api_rate_limit: 200
            cache_ttl: 3600
    outs:
    - path: data/raw/articles.json
      hash: md5
      md5: 01b11a2afb2d63686bc56fa041cc8ea3
      size: 17737473
  preprocess:
    cmd: python -m src.preprocessing.process_data
    deps:
    - path: data/raw/articles.json
      hash: md5
      md5: 01b11a2afb2d63686bc56fa041cc8ea3
      size: 17737473
    - path: src/preprocessing
      hash: md5
      md5: 1b7a5b849da93fecb68b372ce29d3d50.dir
      size: 17714
      nfiles: 6
    params:
      params.yaml:
        preprocessing:
          embeddings:
            model: all-MiniLM-L6-v2
            batch_size: 32
          graph:
            similarity_threshold: 0.7
    outs:
    - path: data/features/embeddings.parquet
      hash: md5
      md5: ebd537e3656b494eee7dc7cd4be82685
      size: 930502
    - path: data/processed/cleaned_articles.parquet
      hash: md5
      md5: 4996c654695b2461868d861acd11a93e
      size: 18694203
  cluster_topics:
    cmd: python -m src.modeling.cluster_topics
    deps:
    - path: data/features/embeddings.parquet
      hash: md5
      md5: ebd537e3656b494eee7dc7cd4be82685
      size: 930502
    - path: src/modeling
      hash: md5
      md5: 10cce2ed75009692fb0eea35bce4aa28.dir
      size: 25874
      nfiles: 3
    params:
      params.yaml:
        models.clustering:
          method: agglomerative
          n_clusters: 100
          random_state: 42
        models.neighbors:
          n_neighbors: 10
          algorithm: auto
    outs:
    - path: models/clustering/cluster_assignments.parquet
      hash: md5
      md5: 8c56f0b29446117a3784846938986b15
      size: 6881
    - path: models/clustering/clusters_summary.parquet
      hash: md5
      md5: 2b5ba2954dc168cd5fb04237f5091d39
      size: 23844
    - path: models/clustering/kmeans_model.pkl
      hash: md5
      md5: e9616a7d4ef458e680b84883d66a7684
      size: 309964
    - path: models/clustering/metrics.json
      hash: md5
      md5: cee2bb7dce8992c206c76afede403735
      size: 47
    - path: models/clustering/nn_index.pkl
      hash: md5
      md5: 603ac08e8696e4ba71097987dcddbd1b
      size: 894548
