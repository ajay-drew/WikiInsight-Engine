schema: '2.0'
stages:
  fetch_data:
    cmd: python -m src.ingestion.fetch_wikipedia_data
    deps:
    - path: src/ingestion
      hash: md5
      md5: cb1ce3265f8ca3412937ef9c62999169.dir
      size: 30951
      nfiles: 3
    params:
      params.yaml:
        data:
          wikipedia:
            site: en.wikipedia.org
            api_rate_limit: 200
            cache_ttl: 3600
    outs:
    - path: data/raw/articles.json
      hash: md5
      md5: 0a4233e1f79c3b8db1af65fdc07f898a
      size: 7885743
  preprocess:
    cmd: python -m src.preprocessing.process_data
    deps:
    - path: data/raw/articles.json
      hash: md5
      md5: 0a4233e1f79c3b8db1af65fdc07f898a
      size: 7885743
    - path: src/preprocessing
      hash: md5
      md5: 9f2defd145b34e2bd5fdc9166c004268.dir
      size: 23210
      nfiles: 5
    params:
      params.yaml:
        preprocessing:
          embeddings:
            model: all-MiniLM-L6-v2
            batch_size: 32
    outs:
    - path: data/features/embeddings.parquet
      hash: md5
      md5: 93ffe1538d0a041cf58ce88c3e97284e
      size: 455142
    - path: data/processed/cleaned_articles.parquet
      hash: md5
      md5: adb27f3ab9f2396fab5a520be50a3f7b
      size: 7556679
  cluster_topics:
    cmd: python -m src.modeling.cluster_topics
    deps:
    - path: data/features/embeddings.parquet
      hash: md5
      md5: 93ffe1538d0a041cf58ce88c3e97284e
      size: 455142
    - path: src/modeling
      hash: md5
      md5: 520c274e32e646c6cec97b52cf490558.dir
      size: 36290
      nfiles: 3
    params:
      params.yaml:
        models.clustering:
          method: agglomerative
          n_clusters: 100
          random_state: 42
        models.neighbors:
          n_neighbors: 10
          algorithm: auto
    outs:
    - path: models/clustering/cluster_assignments.parquet
      hash: md5
      md5: a939e840f5b23dc3b270c5981a40828d
      size: 4882
    - path: models/clustering/clusters_summary.parquet
      hash: md5
      md5: 05620444baa03b709a073f9f7ee9c7c0
      size: 21386
    - path: models/clustering/kmeans_model.pkl
      hash: md5
      md5: b87051b277033329f08a1a40bc2d92bf
      size: 308788
    - path: models/clustering/metrics.json
      hash: md5
      md5: f1c1eb4dda6c699162a95be326f19c64
      size: 263
    - path: models/clustering/nn_index.pkl
      hash: md5
      md5: 9e6fde31fd78106d4c1d25acad8297ff
      size: 442963
  build_graph:
    cmd: python -m src.graph.build_graph
    deps:
    - path: config.yaml
      hash: md5
      md5: fbd8721fa86cc6bd498fda63e583ea4c
      size: 3483
    - path: data/features/embeddings.parquet
      hash: md5
      md5: 93ffe1538d0a041cf58ce88c3e97284e
      size: 455142
    - path: data/processed/cleaned_articles.parquet
      hash: md5
      md5: adb27f3ab9f2396fab5a520be50a3f7b
      size: 7556679
    - path: models/clustering/cluster_assignments.parquet
      hash: md5
      md5: a939e840f5b23dc3b270c5981a40828d
      size: 4882
    params:
      params.yaml:
        graph:
          semantic_similarity_threshold: 0.7
          max_nodes_per_visualization: 100
          enable_cluster_edges: true
    outs:
    - path: data/graph/knowledge_graph.pkl
      hash: md5
      md5: 09743b53641de7274fa7542a954bf55b
      size: 17273
