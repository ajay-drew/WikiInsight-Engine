# WikiInsight Engine Configuration

# Data Sources
data:
  wikipedia:
    site: "en.wikipedia.org"
    api_rate_limit: 200  # requests per second
    cache_ttl: 3600  # seconds

# Ingestion configuration
ingestion:
  # Maximum number of links to keep per article when fetching from Wikipedia.
  max_links_per_article: 50
  # Articles with fewer words than this threshold are treated as stubs and dropped.
  stub_min_words: 200
  # Defaults used by the async ingestion CLI when no flags are provided.
  default_max_articles: 1000
  default_per_query_limit: 50

# Models / Clustering
models:
  clustering:
    # Clustering method:
    # - "agglomerative": hierarchical clustering (recommended for topic drill-down)
    # - "kmeans": flat clustering
    # - "minibatch_kmeans": scalable KMeans variant
    method: "agglomerative"
    n_clusters: 100
    random_state: 42
  
  neighbors:
    n_neighbors: 10
    algorithm: "auto"

# Preprocessing
preprocessing:
  embeddings:
    model: "all-MiniLM-L6-v2"
    batch_size: 32

# Search / BM25 configuration
search:
  bm25:
    # Relative importance of matches in the article title vs body text.
    # Higher title_weight means queries that appear in the title (e.g. "Python (programming language)")
    # are ranked above articles where the term only appears in the body.
    title_weight: 2.0
    body_weight: 1.0
    # When true, use NLTK-based normalization (lowercase, stopwords, lemmatization) for BM25.
    # If NLTK or its data packages are missing, the code falls back to a simple regex tokenizer.
    use_nltk_normalization: true

# API
api:
  host: "0.0.0.0"
  port: 8000
  workers: 4
  rate_limit: 100  # requests per minute


# MLOps
mlops:
  dvc:
    remote: "local"  # or "s3", "gcs"
  
  mlflow:
    tracking_uri: "sqlite:///mlflow.db"
    experiment_name: "wikiinsight"

# Prefect Orchestration
prefect:
  server_url: "http://localhost:4200"  # Optional Prefect server
  retries:
    ingestion: 3
    embeddings: 2
    clustering: 2
  timeouts:
    ingestion: 3600  # 1 hour in seconds
    embeddings: 1800  # 30 min in seconds
    clustering: 1800  # 30 min in seconds
  notifications:
    enabled: false
    webhook_url: ""  # Optional webhook for failures

# Monitoring
monitoring:
  drift:
    enabled: true
    threshold: 0.3  # KS test p-value threshold
    check_after_clustering: true
  stability:
    enabled: true
    ari_threshold: 0.7  # Minimum ARI for stability
  alerts:
    enabled: true
    webhook_url: ""

# Logging
logging:
  level: "INFO"
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  file: "logs/wikiinsight.log"

